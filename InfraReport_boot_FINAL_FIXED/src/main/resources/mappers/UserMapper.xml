<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.infraReport.auth.dao.UserDAO">

    <resultMap id="userResultMap" type="com.infraReport.auth.domain.User">
        <id property="userId" column="USER_ID"/>
        <result property="password" column="PASSWORD"/>
        <result property="userName" column="USER_NAME"/>
        <result property="email" column="EMAIL"/>
        <result property="phone" column="PHONE"/>
        <result property="companyName" column="COMPANY_NAME"/>
        <result property="department" column="DEPARTMENT"/>
        <result property="role" column="ROLE"/>
        <result property="status" column="STATUS"/>
        <result property="createdDate" column="CREATED_DATE"/>
        <result property="lastLoginDate" column="LAST_LOGIN_DATE"/>
    </resultMap>

    <!-- 전체 사용자 조회 -->
    <select id="selectAllUsers" resultMap="userResultMap">
        SELECT USER_ID, PASSWORD, USER_NAME, EMAIL, PHONE, 
               COMPANY_NAME, DEPARTMENT, ROLE, STATUS, 
               CREATED_DATE, LAST_LOGIN_DATE
        FROM TB_USER
        ORDER BY CREATED_DATE DESC
    </select>

    <!-- ID로 사용자 조회 -->
    <select id="selectUserById" parameterType="string" resultMap="userResultMap">
        SELECT USER_ID, PASSWORD, USER_NAME, EMAIL, PHONE, 
               COMPANY_NAME, DEPARTMENT, ROLE, STATUS, 
               CREATED_DATE, LAST_LOGIN_DATE
        FROM TB_USER
        WHERE USER_ID = #{userId}
    </select>

    <!-- 이메일로 사용자 조회 -->
    <select id="selectUserByEmail" parameterType="string" resultMap="userResultMap">
        SELECT USER_ID, PASSWORD, USER_NAME, EMAIL, PHONE, 
               COMPANY_NAME, DEPARTMENT, ROLE, STATUS, 
               CREATED_DATE, LAST_LOGIN_DATE
        FROM TB_USER
        WHERE EMAIL = #{email}
    </select>

    <!-- 사용자 등록 -->
    <insert id="insertUser" parameterType="com.infraReport.auth.domain.User">
        INSERT INTO TB_USER (
            USER_ID, PASSWORD, USER_NAME, EMAIL, PHONE, 
            COMPANY_NAME, DEPARTMENT, ROLE, STATUS
        ) VALUES (
            #{userId}, #{password}, #{userName}, #{email}, #{phone},
            #{companyName}, #{department}, #{role}, #{status}
        )
    </insert>

    <!-- 사용자 수정 -->
    <update id="updateUser" parameterType="com.infraReport.auth.domain.User">
        UPDATE TB_USER
        SET USER_NAME = #{userName},
            EMAIL = #{email},
            PHONE = #{phone},
            COMPANY_NAME = #{companyName},
            DEPARTMENT = #{department}
        WHERE USER_ID = #{userId}
    </update>

    <!-- 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE TB_USER
        SET PASSWORD = #{password}
        WHERE USER_ID = #{userId}
    </update>

    <!-- 마지막 로그인 일시 업데이트 -->
    <update id="updateLastLoginDate">
        UPDATE TB_USER
        SET LAST_LOGIN_DATE = NOW()
        WHERE USER_ID = #{userId}
    </update>

    <!-- 사용자 상태 변경 -->
    <update id="updateStatus">
        UPDATE TB_USER
        SET STATUS = #{status}
        WHERE USER_ID = #{userId}
    </update>

    <!-- 사용자 삭제 -->
    <delete id="deleteUser">
        DELETE FROM TB_USER
        WHERE USER_ID = #{userId}
    </delete>

    <!-- 사용자 ID 존재 여부 확인 -->
    <select id="countByUserId" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM TB_USER WHERE USER_ID = #{userId}
    </select>

    <!-- 이메일 존재 여부 확인 -->
    <select id="countByEmail" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM TB_USER WHERE EMAIL = #{email}
    </select>

</mapper>
